CREATE DATABASE lib; 
USE lib;

CREATE TABLE library (
    bno INT(5),
    bname VARCHAR(40),
    author VARCHAR(20),
    allowed_days INT(5) 
);

CREATE TABLE library_audit (
    bno INT(5),
    old_all_days INT(5), 
    new_all_days INT(5)  
);

INSERT INTO library VALUES(1, 'Database Systems', 'Connally T', 10);
INSERT INTO library VALUES(2, 'System Programming', 'John Donovan', 20);
INSERT INTO library VALUES(3, 'Computer Network & Internet', 'Douglas E. Comer', 18);
INSERT INTO library VALUES(4, 'Agile Project Management', 'Ken Schwaber', 24);
INSERT INTO library VALUES(5, 'Python for Data Analysis', 'Wes McKinney', 12);

DELIMITER //

CREATE TRIGGER tr1 -- Trigger name
BEFORE UPDATE ON library -- Specifies the event (BEFORE UPDATE) and the table (library)
FOR EACH ROW -- Specifies this is a row-level trigger (runs for each affected row)
BEGIN
    -- Insert the old and new values into the audit table
    -- OLD refers to the row's values *before* the update
    -- NEW refers to the row's values *after* the update
    INSERT INTO library_audit (bno, old_all_days, new_all_days) 
    VALUES (NEW.bno, OLD.allowed_days, NEW.allowed_days); --
END //

DELIMITER ;

-- Update allowed_days for book number 1
UPDATE library SET allowed_days = 15 WHERE bno = 1; --

-- Update allowed_days for book number 3
UPDATE library SET allowed_days = 13 WHERE bno = 3; --

-- Update allowed_days for book number 5
UPDATE library SET allowed_days = 17 WHERE bno = 5; --

-- Check the main library table to see the updated values
SELECT * FROM library; --

-- Check the audit table to see the history of changes
SELECT * FROM library_audit; --



